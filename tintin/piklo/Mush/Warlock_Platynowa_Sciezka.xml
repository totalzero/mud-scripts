<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE muclient>
<!-- "Warlock_Platynowa_Sciezka" -->

<muclient>
<plugin
   name="Warlock_Platynowa_Sciezka"
   author="Mercer"
   id="927cf458de184cf4ba63fed5"
   language="Lua"
   date_written="2013-02-19 17:32:08"
   requires="3.42"
   version="1.0"
   >
</plugin>

<!--  Triggers  -->

<triggers>
 <trigger
   enabled="n"
   name="straznik_indeksu"
   match="^(&gt; )?Jestes tak (zmeczony|zmeczona), ze nie mozesz isc w tym kierunku\.$"
   regexp="y"
   script="Cofnij_Indeks_Komendy"
   sequence="1"
 >
 </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   enabled="y"
   match="ps-on"
   script="Wlacz_Platynowa_Sciezke"
   sequence="10"
  >
  </alias>
  <alias
   enabled="y"
   match="ps-off"
   script="Wylacz_Platynowa_Sciezke"
   sequence="10"
  >
  </alias>
  <alias
   enabled="y"
   match="krocz_platynowa_sciezka"
   script="Podazaj_Platynowa_Sciezka"
   sequence="10"
  >
  </alias>
  <alias
   enabled="n"
   group="ps_komendy"
   match="komendy_sklep_minas_tirith"
   script="Wyslij_Komendy_Sklep_Minas_Tirith"
   sequence="10"
  >
  </alias>
  <alias
   enabled="n"
   group="ps_komendy"
   match="komendy_bank_minas_tirith"
   script="Wyslij_Komendy_Bank_Minas_Tirith"
   sequence="10"
  >
  </alias>
  <alias
   enabled="y"
   match="ps-help"
   script="Platynowa_Sciezka_Instrukcja"
   sequence="10"
  >
  </alias>
</aliases>

<!--  Variables  -->

<variables>
  <variable name="zm_platynowa_sciezka">off</variable>
  <variable name="zm_indeks_komendy">1</variable>
</variables>

<!--  Script  -->

<script>
<![CDATA[

function OnPluginInstall ()
  Komendy_Tab = {"poludnie", "poludnie", "poludniowy-zachod", "poludniowy-zachod", "poludniowy-zachod", "polnocny-zachod", "polnocny-wschod", "polnoc", "polnoc", "polnoc", "polnoc", "polnoc", "polnoc", "polnoc", "polnocny-zachod", "polnocny-zachod", "poludniowy-zachod", "poludniowy-wschod", "poludnie", "poludnie", "poludnie", "poludnie", "poludnie", "poludnie", "poludniowy-zachod", "poludniowy-zachod", "zachod", "zachod", "poludnie", "komendy_sklep_minas_tirith", "polnoc", "wschod", "wschod", "polnocny-wschod", "polnocny-wschod", "polnoc", "polnoc", "polnoc", "polnoc", "polnoc", "polnoc", "polnocny-zachod", "polnocny-wschod", "poludniowy-wschod", "poludniowy-wschod", "poludnie", "poludnie", "poludnie", "poludnie", "poludnie", "poludnie", "poludnie", "poludniowy-zachod", "poludniowy-wschod", "poludniowy-zachod", "poludniowy-zachod", "zachod", "polnoc", "komendy_bank_minas_tirith", "poludnie", "wschod", "polnocny-wschod", "polnocny-wschod", "polnocny-wschod", "polnocny-wschod", "polnocny-wschod", "polnoc", "polnoc"}
end

function Wlacz_Platynowa_Sciezke()
  if GetVariable("zm_platynowa_sciezka") == "off" then
    EnableTrigger("straznik_indeksu", true)
    SetVariable("zm_indeks_komendy", "1")
    EnableAliasGroup("ps_komendy", true)
    SetVariable("zm_platynowa_sciezka", "on")
    ColourNote("sandybrown", "black", "Wkraczasz na platynowa sciezke.")
  else
    ColourNote("sandybrown", "black", "Przeciez juz kroczysz platynowa sciezka.")
  end
end

function Wylacz_Platynowa_Sciezke()
  if GetVariable("zm_platynowa_sciezka") == "on" then
    EnableAliasGroup("ps_komendy", false)
    EnableTrigger("straznik_indeksu", false)
    SetVariable("zm_platynowa_sciezka", "off")
    ColourNote("sandybrown", "black", "Schodzisz z platynowej sciezki.")
  else
    ColourNote("sandybrown", "black", "Wcale nie kroczysz platynowa sciezka.")
  end
end

function Podazaj_Platynowa_Sciezka()
  if GetVariable("zm_platynowa_sciezka") == "on" then
    local indeks_komendy = tonumber(GetVariable("zm_indeks_komendy"))
    if Komendy_Tab[indeks_komendy] ~= nil then
      SetVariable("zm_indeks_komendy", GetVariable("zm_indeks_komendy")+1)
      Execute(Komendy_Tab[indeks_komendy])
    else
      EnableAliasGroup("ps_komendy", false)
      EnableTrigger("straznik_indeksu", false)
      SetVariable("zm_platynowa_sciezka", "off")
      ColourNote("sandybrown", "black", "Dotarles do kresu platynowej sciezki.")
    end
  else
    ColourNote("sandybrown", "black", "Najpierw wkrocz na platynowa sciezke.")
  end  
end

function Wyslij_Komendy_Sklep_Minas_Tirith()
  Send("sprzedaj wszystko")
  Send("odloz monety")
  Send("wez wszystko z plecaka")
  Send("sprzedaj wszystko")
  Send("odloz monety")
  Send("wez wszystko z plecaka")
  Send("sprzedaj wszystko")
  Send("wez monety")
  Send("wloz monety do plecaka")
  Send("wez monety ")
  Send("wloz monety do plecaka")
end

function Wyslij_Komendy_Bank_Minas_Tirith()
  Send("wez monety z plecaka")
  Send("zdenominuj monety")
  Send("wez monety z plecaka")
  Send("zdenominuj")
  Send("wloz monety do plecaka")
end

function Cofnij_Indeks_Komendy()
  SetVariable("zm_indeks_komendy", GetVariable("zm_indeks_komendy")-1)
end

function Platynowa_Sciezka_Instrukcja()
  Note("")
  ColourNote("crimson", "black", "Instrukcja:")
  Note("")
  ColourTell("crimson", "black", "1) ")
  ColourNote("sandybrown", "black", "Punktem startowym platynowej sciezki jest lokacja z tablica ogloszeniowa w Minas Tirith.")
  Note("")
  ColourTell("crimson", "black", "2) ")
  ColourTell("sandybrown", "black", "Zbinduj komende ")
  ColourTell("crimson", "black", "\"krocz_platynowa_sciezka\"")
  ColourNote("sandybrown", "black", ".")
  Note("")
  ColourTell("crimson", "black", "3) ")
  ColourTell("sandybrown", "black", "Komenda ")
  ColourTell("crimson", "black", "\"ps-on\"")
  ColourNote("sandybrown", "black", " uruchom skrypt.")
  Note("")
  ColourTell("crimson", "black", "4) ")
  ColourTell("sandybrown", "black", "Od tego momentu uzywaj wylacznie binda z ")
  ColourTell("crimson", "black", "\"krocz_platynowa_sciezka\"")
  ColourNote("sandybrown", "black", ", az wyswietli sie komunikat o dotarciu do kresu platynowej sciezki. Bedzie to oznaczac, ze skrypt automatycznie zakonczyl swoje dzialanie.")
  Note("")
  ColourTell("crimson", "black", "5) ")
  ColourTell("sandybrown", "black", "Gdyby wystapila taka potrzeba, komenda ")
  ColourTell("crimson", "black", "\"ps-off\"")
  ColourNote("sandybrown", "black", " pozwala manualnie wylaczyc skrypt.")
end

]]>
</script>

</muclient>